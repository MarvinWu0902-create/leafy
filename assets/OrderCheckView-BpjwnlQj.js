import{p as F,q as $,E,f as w,m as C,_ as S,o as a,c,b as e,a as r,w as f,n as b,h as d,k as B,d as i,v as m,r as _,l as I,F as D,g as j,t as n}from"./index-DciNioPc.js";import{P as N}from"./ProgressBar-2xQ6k8uV.js";import{D as U}from"./DiscountBar-C8AsgRnv.js";import{o as k}from"./order-CSBD3Mkb.js";import{A as O}from"./AdjustCartBtn-EKL0W0ZD.js";import{T as M}from"./ToastCard-C4XrGxB0.js";import{c as V}from"./cart-DVyuMAG3.js";import{a as R}from"./axios-Bo0ATomq.js";const q={components:{VeeField:F,VeeForm:$,VeeErrorMessage:E},data(){return{user:{email:"",name:"",tel:"",address:""},message:""}},computed:{...w(k,["orderStatus","orderLoading"])},methods:{isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"},onSubmit(){this.postOrder(this.user,this.message)},...C(k,["orderChange","postOrder"])}},H=e("h3",{class:"p-4 bg-gray-400/10"},"填寫訂購資訊",-1),z={class:"p-4"},G={class:"flex flex-col mb-2"},J=e("label",{class:"mb-2",for:"email"},[e("span",{class:"text-red-400"},"*"),i(" E-mail ")],-1),K={class:"flex flex-col mb-2"},Q=e("label",{class:"mb-2",for:"consignee"},[e("span",{class:"text-red-400"},"*"),i(" 收件人姓名 ")],-1),W={class:"flex flex-col mb-2"},X=e("label",{class:"mb-2",for:"phone"},[e("span",{class:"text-red-400"},"*"),i(" 連絡電話 ")],-1),Y={class:"flex flex-col mb-2"},Z=e("label",{class:"mb-2",for:"address"},[e("span",{class:"text-red-400"},"*"),i(" 收件地址 ")],-1),ee={class:"flex flex-col mb-2"},se=e("label",{class:"mb-2",for:"remark"}," 備註 ",-1),te=["disabled"];function oe(s,o,L,T,l,p){const g=_("VeeField"),v=_("VeeErrorMessage"),x=_("font-awesome-icon"),y=_("VeeForm");return a(),c("div",null,[H,e("div",z,[r(y,{onSubmit:p.onSubmit},{default:f(({errors:h})=>[e("div",G,[J,r(g,{class:b(["p-2 mb-2 border focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary/30",{"is-invalid":h.email}]),id:"email",name:"email",type:"email",placeholder:"請輸入 Email",rules:"email|required",modelValue:l.user.email,"onUpdate:modelValue":o[0]||(o[0]=u=>l.user.email=u)},null,8,["class","modelValue"]),r(v,{name:"email",class:"text-sm text-red-400 invalid-feedback"})]),e("div",K,[Q,r(g,{class:b(["p-2 mb-2 border focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary/30",{"is-invalid":h.姓名}]),id:"consignee",name:"姓名",type:"text",placeholder:"請輸入 姓名",rules:"required",modelValue:l.user.name,"onUpdate:modelValue":o[1]||(o[1]=u=>l.user.name=u)},null,8,["class","modelValue"]),r(v,{name:"姓名",class:"text-sm text-red-400 invalid-feedback"})]),e("div",W,[X,r(g,{class:b(["p-2 mb-2 border focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary/30",{"is-invalid":h.電話}]),id:"phone",name:"電話",type:"text",placeholder:"請輸入 電話",rules:p.isPhone,modelValue:l.user.tel,"onUpdate:modelValue":o[2]||(o[2]=u=>l.user.tel=u)},null,8,["class","rules","modelValue"]),r(v,{name:"電話",class:"text-sm text-red-400 invalid-feedback"})]),e("div",Y,[Z,r(g,{class:b(["p-2 mb-2 border focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary/30",{"is-invalid":h.地址}]),id:"address",name:"地址",type:"text",placeholder:"請輸入 地址",rules:"required",modelValue:l.user.address,"onUpdate:modelValue":o[3]||(o[3]=u=>l.user.address=u)},null,8,["class","modelValue"]),r(v,{name:"地址",class:"text-sm text-red-400 invalid-feedback"})]),e("div",ee,[se,d(e("textarea",{class:"p-2 mb-2 border focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary/30",name:"備註",id:"remark",rows:"3","onUpdate:modelValue":o[4]||(o[4]=u=>l.message=u)},null,512),[[B,l.message]])]),e("button",{type:"submit",class:b(["w-full py-2 text-white transition duration-300 rounded bg-primary hover:bg-primary-darker",{"cursor-wait":s.orderLoading.post}]),disabled:s.orderLoading.post},[i("建立訂單 "),d(r(x,{icon:["fas","spinner"],"spin-pulse":"",class:"text-white"},null,512),[[m,s.orderLoading.post]])],10,te)]),_:1},8,["onSubmit"])])])}const re=S(q,[["render",oe]]);var ne={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"marvinapipath",BASE_URL:"/leafy/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:ie,VITE_PATH:le}=ne,ae=s=>R.post(`${ie}/api/${le}/coupon`,{data:{code:s}}),P=I("coupon",{state(){return{couponCode:"iloveleafy",couponLoading:{postCoupon:!1},resInfo:""}},getters:{iscouponApply(){var o;const{cartData:s}=V();return((o=s[0])==null?void 0:o.coupon)!==void 0}},actions:{postCoupon(s){this.couponLoading.postCoupon=!0,ae(s).then(o=>{this.resInfo=o.data;const{getCart:L}=V();L()}).then(()=>{this.couponLoading.postCoupon=!1}).catch(()=>{this.resInfo="套用優惠券失敗"})}}}),ce={components:{ProgressBar:N,DiscountBar:U,ContactForm:re,AdjustCartBtn:O,ToastCard:M},data(){return{freightPrice:20,freightLimit:100}},computed:{...w(V,["cartData","tempId","iscartOpen","cartLoading","finaltotalPrice","totalPrice"]),...w(k,["orderStatus","orderLoading"]),...w(P,["couponCode","couponLoading","resInfo","iscouponApply"]),isDiscount(){return this.cartData.filter(s=>s.product.origin_price!==s.product.price).length||this.cartData.map(s=>s.total).reduce((s,o)=>s+o,0)>=this.freightLimit},isoverFreightLimit(){return this.cartData.map(s=>s.total).reduce((s,o)=>s+o,0)>=this.freightLimit},ispromotionalSales(){return this.cartData.filter(s=>s.product.origin_price!==s.product.price).length},sumPrice(){let s=this.iscouponApply?this.finaltotalPrice:this.totalPrice;return this.isoverFreightLimit||(s+=this.freightPrice),s}},methods:{...C(V,["getCart","deleteCart","cartClick"]),...C(k,["orderChange"]),...C(P,["postCoupon"])},watch:{cartData(s){s.length?this.orderChange("check"):(this.iscartOpen&&this.cartClick(),this.$router.push("/productlist"))},iscouponApply(){this.getCart()}},mounted(){this.getCart()}},de={class:"container mb-10"},pe=e("h3",{class:"p-4 bg-gray-400/10"},"購物車",-1),ue={class:"hidden p-4 border md:block"},me={class:"w-full mb-4 border"},_e=e("thead",null,[e("tr",{class:"font-normal"},[e("th",{class:"p-4 font-normal text-start"},"商品資料"),e("th",{class:"py-4 font-normal"},"單件價格"),e("th",{class:"py-4 font-normal"},"數量"),e("th",{class:"py-4 font-normal"},"小計"),e("th"),e("th")])],-1),he={class:"flex p-4"},fe={class:"w-32 me-4"},be=["src"],ge={class:"flex flex-col items-baseline justify-center w-full"},ve={class:"px-1 leading-6 text-white rounded bg-primary-darker"},ye={class:"font-normal"},xe={class:"w-24 text-sm text-center"},we={class:"w-20 text-sm text-end pe-4"},Ce={class:"p-4"},ke=["onClick"],Ve=e("span",{class:"text-sm font-black material-symbols-outlined"}," close ",-1),Le=[Ve],De={key:0},je=e("div",{class:"p-4 border"},"優惠",-1),Pe={class:"p-4 border"},Se=e("p",{class:"mb-4 text-sm"},"已享用之優惠",-1),Te={key:1},Ae=e("div",{class:"p-4 border"},"優惠",-1),Fe=e("div",{class:"p-4 border"},[e("p",{class:"mb-4 text-sm"},"未享有優惠")],-1),$e=[Ae,Fe],Ee={class:"block p-4 border md:hidden"},Be={class:"flex justify-between p-4"},Ie={class:"flex"},Ne={class:"w-24 me-4"},Ue=["src"],Oe={class:"flex flex-col items-baseline justify-center"},Me={class:"px-1 text-sm leading-6 text-white rounded bg-primary-darker"},Re={class:"text-sm font-normal"},qe={class:"flex flex-col justify-between"},He=["onClick"],ze=e("span",{class:"text-sm font-black material-symbols-outlined"}," close ",-1),Ge=[ze],Je={class:"flex justify-between p-4"},Ke={class:"flex items-center"},Qe={class:"text-end"},We={key:0},Xe=e("div",{class:"p-4 border"},"優惠",-1),Ye={class:"p-4 border"},Ze=e("p",{class:"mb-4 text-sm"},"已享用之優惠",-1),es={key:1},ss=e("div",{class:"p-4 border"},"優惠",-1),ts=e("div",{class:"p-4 border"},[e("p",{class:"mb-4 text-sm"},"未享有優惠")],-1),os=[ss,ts],rs={class:"container flex flex-col items-baseline mb-10 md:flex-row"},ns={class:"w-full mx-0 mb-10 border md:me-4 md:mb-0"},is=e("h3",{class:"p-4 bg-gray-400/10"},"訂單資訊",-1),ls={class:"flex flex-col justify-between p-4"},as={class:"flex justify-between mb-4"},cs=e("p",null,"小計",-1),ds={class:"flex justify-between mb-4"},ps=e("p",null,"運費",-1),us={key:0},ms={key:1},_s=e("p",null,"優惠代碼",-1),hs={class:"flex justify-between mb-4"},fs=["value","disabled"],bs=["disabled"],gs={class:"flex justify-between py-4 mb-2 font-bold border-t border-b"},vs=e("p",null,"合計",-1);function ys(s,o,L,T,l,p){const g=_("ToastCard"),v=_("ProgressBar"),x=_("AdjustCartBtn"),y=_("font-awesome-icon"),h=_("DiscountBar"),u=_("ContactForm");return a(),c("div",null,[r(g,{"toast-msg":s.resInfo,"show-time":2e3},null,8,["toast-msg"]),r(v,{class:"mt-10 mb-16"}),d(e("div",de,[pe,e("div",ue,[e("table",me,[_e,e("tbody",null,[(a(!0),c(D,null,j(s.cartData,t=>(a(),c("tr",{class:"border",key:t.id},[e("td",he,[e("div",fe,[e("img",{class:"object-cover w-full h-20",src:t.product.imageUrl,alt:"#"},null,8,be)]),e("div",ge,[e("p",ve,n(t.product.category),1),e("p",ye,n(t.product.title),1)])]),e("td",xe,[i(" NT$ "+n(t.product.price)+" ",1),d(e("del",{class:"text-sm text-gray-400"},n(t.product.origin_price),513),[[m,t.product.price!==t.product.origin_price]])]),e("td",null,[r(x,{class:"w-2/3 mx-auto","cart-data":t},null,8,["cart-data"])]),e("td",we,"NT$"+n(t.total),1),e("td",Ce,[e("a",{class:"flex items-center justify-center cursor-pointer text-gray-500/50 hover:text-gray-500",onClick:A=>s.deleteCart("single",t.id)},Le,8,ke)]),e("td",null,[d(r(y,{icon:["fas","spinner"],"spin-pulse":"",class:"text-gray-400"},null,512),[[m,s.cartLoading.adjustCart&&s.tempId===t.id]])])]))),128))])]),p.isDiscount?(a(),c("div",De,[je,e("div",Pe,[Se,d(r(h,{class:"mb-2",color:"bg-green-400/50"},{name:f(()=>[i("免運優惠")]),content:f(()=>[i("滿$"+n(l.freightLimit)+"免運",1)]),_:1},512),[[m,p.isoverFreightLimit]]),d(r(h,{color:"bg-red-400/50"},{name:f(()=>[i("活動優惠")]),content:f(()=>[i("季活動促銷(折扣金額依商品不同而有差異)")]),_:1},512),[[m,p.ispromotionalSales]])])])):(a(),c("div",Te,$e))]),e("div",Ee,[(a(!0),c(D,null,j(s.cartData,t=>(a(),c("div",{class:"border",key:t.id},[e("div",Be,[e("div",Ie,[e("div",Ne,[e("img",{class:"object-cover w-full h-20",src:t.product.imageUrl,alt:"#"},null,8,Ue)]),e("div",Oe,[e("p",Me,n(t.product.category),1),e("p",Re,n(t.product.title),1)])]),e("div",qe,[e("a",{class:"flex items-center justify-end cursor-pointer text-gray-500/50 hover:text-gray-500",onClick:A=>s.deleteCart("single",t.id)},Ge,8,He),e("p",null,[i(" NT$ "+n(t.product.price)+" ",1),d(e("del",{class:"text-sm text-gray-400"},n(t.product.origin_price),513),[[m,t.product.price!==t.product.origin_price]])])])]),e("div",Je,[e("div",Ke,[r(x,{class:"w-2/3 me-3","cart-data":t},null,8,["cart-data"]),d(r(y,{icon:["fas","spinner"],"spin-pulse":"",class:"text-gray-400"},null,512),[[m,s.cartLoading.adjustCart&&s.tempId===t.id]])]),e("p",Qe,"NT$"+n(t.total),1)])]))),128)),p.isDiscount?(a(),c("div",We,[Xe,e("div",Ye,[Ze,d(r(h,{class:"mb-2",color:"bg-green-400/50"},{name:f(()=>[i("免運優惠")]),content:f(()=>[i("滿$"+n(l.freightLimit)+"免運",1)]),_:1},512),[[m,p.isoverFreightLimit]]),d(r(h,{color:"bg-red-400/50"},{name:f(()=>[i("活動優惠")]),content:f(()=>[i("季活動促銷(折扣金額依商品不同而有差異)")]),_:1},512),[[m,p.ispromotionalSales]])])])):(a(),c("div",es,os))])],512),[[m,!s.cartLoading.getCart]]),e("div",rs,[e("div",ns,[is,e("div",ls,[e("div",null,[e("div",as,[cs,e("p",null,"NT$"+n(s.finaltotalPrice),1)]),e("div",ds,[ps,p.isoverFreightLimit?(a(),c("p",us,"免運")):(a(),c("p",ms,"NT$"+n(l.freightPrice),1))]),_s,e("div",hs,[e("input",{class:b(["w-full p-2 text-center text-gray-400 border focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary/30",{"cursor-not-allowed":s.iscouponApply}]),type:"text",value:s.couponCode,disabled:s.iscouponApply},null,10,fs),e("button",{type:"button",class:b(["w-full text-white",{"bg-gray-400 cursor-not-allowed":s.iscouponApply,"bg-primary hover:bg-primary-darker":!s.iscouponApply}]),onClick:o[0]||(o[0]=t=>s.postCoupon(s.couponCode)),disabled:s.iscouponApply},[i(n(s.iscouponApply?"已套用":"套用優惠券")+" ",1),d(r(y,{icon:["fas","spinner"],"spin-pulse":"",class:"text-white"},null,512),[[m,s.couponLoading.postCoupon]])],10,bs)])]),e("div",gs,[vs,e("p",null,"NT$"+n(p.sumPrice),1)])])]),r(u,{class:"w-full mx-0 border form-info md:ms-4"})])])}const Ps=S(ce,[["render",ys]]);export{Ps as default};

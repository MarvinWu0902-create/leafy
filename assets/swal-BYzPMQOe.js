import{l as D,m,_ as w,o as c,c as l,b as i,F as C,g as L,n as O,t as I,f as S,a as P,w as v,e as x,T as $,s as f}from"./index-DciNioPc.js";import{a as d}from"./axios-Bo0ATomq.js";import{m as u}from"./modal-OjTRLY9X.js";var T={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"marvinapipath",BASE_URL:"/leafy/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:h,VITE_PATH:p}=T,j=(t,e=1)=>d.get(`${h}/api/${p}/admin/products?page=${e}${t!=="all"?`&category=${t}`:""}`),k=t=>d.put(`${h}/api/${p}/admin/product/${t.id}`,{data:{title:t.title,category:t.category,origin_price:t.origin_price,price:t.price,unit:t.unit,description:t.description,content:t.content,is_enabled:t.is_enabled,imageUrl:t.imageUrl,imagesUrl:t.imagesUrl}}),B=t=>d.post(`${h}/api/${p}/admin/product`,{data:t}),E=t=>d.delete(`${h}/api/${p}/admin/product/${t}`),M=D("dashboard-product",{state(){return{allproductData:[],productData:[],tempProduct:{imagesUrl:[]},resInfo:{},filterCategory:"all",categoryData:[],paginationData:{},currentPage:0,productLoading:{getProduct:!1,postProduct:!1,adjustProduct:!1,deleteProduct:!1}}},actions:{getProduct(t,e){const{closeModal:a}=u();this.currentPage=e,this.productLoading.getProduct=!0,j(t,e).then(o=>{t==="all"&&(this.allproductData=o.data.products),this.productData=o.data.products,this.paginationData=o.data.pagination,this.productLoading.getProduct=!1,a()}).catch(()=>{alert("取得產品資料失敗")})},deleteProduct(t){this.productLoading.deleteProduct=!0,E(t).then(e=>{this.productLoading.deleteProduct=!1,this.resInfo=e.data,this.getProduct(this.filterCategory,this.currentPage)}).catch(e=>{this.productLoading.deleteProduct=!1,this.resInfo=e.response.data})},productBtbClick(t,e){const{openModal:a,setmodalStatus:o,currentpageReset:s}=u();t==="add"?this.tempProduct={imagesUrl:["","",""]}:t==="adjust"?this.tempProduct=JSON.parse(JSON.stringify(e)):this.tempProduct=e,o(t),s(),a()},modalConfirmClick(t,e){t==="adjust"?(this.productLoading.adjustProduct=!0,k(e).then(a=>{this.productLoading.adjustProduct=!1,this.resInfo=a.data,this.getProduct(this.filterCategory,this.currentPage)}).catch(a=>{this.productLoading.adjustProduct=!1,this.resInfo=a.response.data})):t==="add"&&(this.productLoading.postProduct=!0,B(e).then(a=>{this.productLoading.postProduct=!1,this.resInfo=a.data,this.getProduct(this.filterCategory,this.currentPage)}).catch(a=>{this.productLoading.postProduct=!1,this.resInfo=a.response.data}))},categoryChange(t){this.filterCategory=t}}});var V={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"marvinapipath",BASE_URL:"/leafy/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:_,VITE_PATH:y}=V,b=t=>d.get(`${_}/api/${y}/admin/orders?page=${t}`),U=t=>d.put(`${_}/api/${y}/admin/order/${t.id}`,{data:t}),R=t=>d.delete(`${_}/api/${y}/admin/order/${t}`),A=D("dashboard-order",{state(){return{orderData:[],paginationData:[],resInfo:{},orderLoading:{getOrder:!1,adjustOrder:!1,deleteOrder:!1},tempId:"",tempProductId:"",currentPage:0}},getters:{tempOrder(){return this.orderData.filter(t=>t.id===this.tempId)[0]}},actions:{getOrder(t){this.currentPage=t,this.orderLoading.getOrder=!0,b(t).then(e=>{this.orderLoading.getOrder=!1;const{orders:a,pagination:o}=e.data;this.orderData=a,this.paginationData=o}).catch(()=>{alert("取得訂單資料失敗")})},orderBtnClick(t,e){const{openModal:a,setmodalStatus:o}=u();this.tempId=e,o(t),a()},adjustOrder(t){const e={...t,products:{...t.products}};let a=0;Object.keys(e.products).forEach(o=>{const s={...e.products[o]},{origin_price:n,price:r}=s.product,{qty:g}=s;s.final_total=r*g,s.total=n*g,a+=s.final_total,e.products[o]=s}),e.total=a,this.orderLoading.adjustOrder=!0,U(e).then(o=>(this.resInfo=o.data,b(this.currentPage))).then(o=>{this.orderLoading.adjustOrder=!1;const{orders:s,pagination:n}=o.data;this.orderData=s,this.paginationData=n}).catch(o=>{this.orderLoading.adjustOrder=!1,this.resInfo=o.response.data})},deleteOrder(t){this.orderLoading.deleteOrder=!0,R(t).then(e=>{this.orderLoading.deleteOrder=!1,this.resInfo=e.data,this.getOrder(this.currentPage)}).catch(e=>{this.resInfo=e.response.data})}}}),H={props:["paginationData","categoryData"],computed:{isMode(){return this.categoryData?"product":"order"}},methods:{...m(M,["getProduct"]),...m(A,["getOrder"]),paginationClick(t){this.isMode==="product"?this.getProduct(this.categoryData,t):this.isMode==="order"&&this.getOrder(t)}}},N={class:"flex items-center justify-center mb-10 cursor-pointer pagination"},z=i("span",{class:"material-symbols-outlined"}," navigate_before ",-1),F=[z],J=["onClick"],q=i("span",{class:"material-symbols-outlined"}," navigate_next ",-1),G=[q];function K(t,e,a,o,s,n){return c(),l("div",null,[i("div",N,[i("button",{type:"button",class:"flex items-center justify-center w-8 p-1 border previous hover:text-white hover:bg-primary rounded-s-md",onClick:e[0]||(e[0]=r=>n.paginationClick(a.paginationData.current_page===1?1:a.paginationData.current_page-1))},F),(c(!0),l(C,null,L(a.paginationData.total_pages,r=>(c(),l("button",{type:"button",class:O(["block w-8 p-1 text-center border hover:text-white hover:bg-primary",{"text-white bg-primary":a.paginationData.current_page===r,"text-black bg-white":a.paginationData.current_page!==r}]),key:r,onClick:g=>n.paginationClick(r)},I(r),11,J))),128)),i("button",{type:"button",class:"flex items-center justify-center w-8 p-1 border next hover:text-white hover:bg-primary rounded-e-md",onClick:e[1]||(e[1]=r=>n.paginationClick(a.paginationData.current_page===a.paginationData.total_pages?a.paginationData.total_pages:a.paginationData.current_page+1))},G)])])}const ct=w(H,[["render",K]]),Q={computed:{...S(u,["isModalShow"])},methods:{...m(u,["closeModal"])},watch:{isModalShow(t){t?document.body.style.overflow="hidden":(this.currentimgIndex=-1,document.body.style.overflow="auto")}}},W={key:0,class:"fixed inset-0 z-10 flex items-center justify-center bg-black/50"},X={key:0,class:"fixed inset-0 z-20 flex items-center justify-center"},Y={class:"w-1/2 max-h-full overflow-x-auto bg-white rounded-lg shadow-lg"},Z={class:"flex justify-between bg-black/90"},tt={class:"flex flex-col justify-center me-3"},et=i("span",{class:"text-white transition duration-200 material-symbols-outlined group-hover:text-gray-300"}," close ",-1),at=[et],ot={class:"p-4"},st={class:"flex justify-end p-4"};function it(t,e,a,o,s,n){return c(),l("div",null,[P($,{name:"fade","enter-active-class":"transition duration-300","leave-active-class":"transition duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-from-class":"opacity-100 ","leave-to-class":"opacity-0"},{default:v(()=>[t.isModalShow?(c(),l("div",W)):x("",!0)]),_:1}),P($,{name:"content","enter-active-class":"transition duration-300","leave-active-class":"transition duration-300","enter-from-class":"opacity-0 translate-y-[100px]","enter-to-class":"translate-y-0 opacity-100","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"opacity-0 translate-y-[100px]"},{default:v(()=>[t.isModalShow?(c(),l("div",X,[i("div",Y,[i("header",Z,[f(t.$slots,"header"),i("div",tt,[i("a",{class:"flex items-center justify-center cursor-pointer group",onClick:e[0]||(e[0]=(...r)=>t.closeModal&&t.closeModal(...r))},at)])]),i("section",ot,[f(t.$slots,"section")]),i("footer",st,[f(t.$slots,"footer")])])])):x("",!0)]),_:3})])}const lt=w(Q,[["render",it]]),ut={props:{title:String,text:String,icon:String,confirmButtonText:String,cancelButtonText:String,showCancelButton:Boolean},methods:{showAlert(){this.$swal.fire({title:this.title,text:this.text,icon:this.icon,confirmButtonText:this.confirmButtonText,showCancelButton:this.showCancelButton,cancelButtonText:this.cancelButtonText}).then(t=>{t.isConfirmed?this.$emit("status","confirmed"):t.isDismissed&&this.$emit("status","dismissed")})}},mounted(){this.showAlert()}},ht={data(){return{swalConfig:{title:"確定要刪除嗎?",text:"刪除後，則無法復原",icon:"warning",showCancelButton:!0,confirmButtonText:"確認",cancelButtonText:"取消"}}}};export{lt as M,ct as P,ut as _,A as o,M as p,ht as s};
